-- Create city_centers table for storing normalized city names and coordinates
-- This table enables accurate radius-based filtering regardless of city name variations

CREATE TABLE IF NOT EXISTS public.city_centers (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  normalized_name TEXT NOT NULL,
  state TEXT,
  country TEXT DEFAULT 'US',
  center_latitude DECIMAL(10, 8) NOT NULL,
  center_longitude DECIMAL(11, 8) NOT NULL,
  aliases TEXT[] DEFAULT '{}',
  event_count INTEGER DEFAULT 0,
  population INTEGER,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW(),
  UNIQUE(normalized_name, state, country)
) TABLESPACE pg_default;

-- Create indexes for efficient queries
CREATE INDEX IF NOT EXISTS idx_city_centers_name ON public.city_centers(normalized_name) TABLESPACE pg_default;
CREATE INDEX IF NOT EXISTS idx_city_centers_state ON public.city_centers(state) TABLESPACE pg_default;
CREATE INDEX IF NOT EXISTS idx_city_centers_coordinates ON public.city_centers(center_latitude, center_longitude) TABLESPACE pg_default;
CREATE INDEX IF NOT EXISTS idx_city_centers_aliases ON public.city_centers USING GIN(aliases) TABLESPACE pg_default;
CREATE INDEX IF NOT EXISTS idx_city_centers_event_count ON public.city_centers(event_count DESC) TABLESPACE pg_default;

-- Create trigger to update updated_at timestamp
CREATE TRIGGER update_city_centers_updated_at 
BEFORE UPDATE ON public.city_centers 
FOR EACH ROW 
EXECUTE FUNCTION update_updated_at_column();

-- Insert top 250 US cities by population with coordinates and aliases
INSERT INTO public.city_centers (normalized_name, state, country, center_latitude, center_longitude, aliases, population) VALUES
-- Top 50 cities
('New York', 'NY', 'US', 40.7128, -74.0060, ARRAY['NYC', 'New York City', 'New York, NY'], 8336817),
('Los Angeles', 'CA', 'US', 34.0522, -118.2437, ARRAY['LA', 'L.A.', 'Los Angeles, CA'], 3971883),
('Chicago', 'IL', 'US', 41.8781, -87.6298, ARRAY['Chi', 'Chi.', 'Chicago, IL'], 2693976),
('Houston', 'TX', 'US', 29.7604, -95.3698, ARRAY['Houston, TX'], 2320268),
('Phoenix', 'AZ', 'US', 33.4484, -112.0740, ARRAY['Phx', 'Phx.', 'Phoenix, AZ'], 1680992),
('Philadelphia', 'PA', 'US', 39.9526, -75.1652, ARRAY['Philly', 'Philadelphia, PA'], 1584064),
('San Antonio', 'TX', 'US', 29.4241, -98.4936, ARRAY['San Antonio, TX'], 1547253),
('San Diego', 'CA', 'US', 32.7157, -117.1611, ARRAY['SD', 'San Diego, CA'], 1423851),
('Dallas', 'TX', 'US', 32.7767, -96.7970, ARRAY['Dallas, TX'], 1343573),
('San Jose', 'CA', 'US', 37.3382, -121.8863, ARRAY['San Jose, CA'], 1021795),
('Austin', 'TX', 'US', 30.2672, -97.7431, ARRAY['Austin, TX'], 978908),
('Jacksonville', 'FL', 'US', 30.3322, -81.6557, ARRAY['Jacksonville, FL'], 949611),
('Fort Worth', 'TX', 'US', 32.7555, -97.3308, ARRAY['Fort Worth, TX'], 918915),
('Columbus', 'OH', 'US', 39.9612, -82.9988, ARRAY['Columbus, OH'], 905748),
('Charlotte', 'NC', 'US', 35.2271, -80.8431, ARRAY['Charlotte, NC'], 885708),
('San Francisco', 'CA', 'US', 37.7749, -122.4194, ARRAY['SF', 'S.F.', 'San Francisco, CA'], 873965),
('Indianapolis', 'IN', 'US', 39.7684, -86.1581, ARRAY['Indy', 'Indianapolis, IN'], 887642),
('Seattle', 'WA', 'US', 47.6062, -122.3321, ARRAY['Sea', 'Sea.', 'Seattle, WA'], 737015),
('Denver', 'CO', 'US', 39.7392, -104.9903, ARRAY['Den', 'Den.', 'Denver, CO'], 715522),
('Washington', 'DC', 'US', 38.9072, -77.0369, ARRAY['Washington DC', 'Washington D.C.', 'Washington D C', 'DC', 'D.C.', 'Washington, DC'], 705749),
('Boston', 'MA', 'US', 42.3601, -71.0589, ARRAY['Boston, MA'], 692600),
('El Paso', 'TX', 'US', 31.7619, -106.4850, ARRAY['El Paso, TX'], 678815),
('Detroit', 'MI', 'US', 42.3314, -83.0458, ARRAY['Detroit, MI'], 639111),
('Nashville', 'TN', 'US', 36.1627, -86.7816, ARRAY['Nashville, TN'], 689447),
('Portland', 'OR', 'US', 45.5152, -122.6784, ARRAY['Portland, OR'], 652503),
('Oklahoma City', 'OK', 'US', 35.4676, -97.5164, ARRAY['OKC', 'Oklahoma City, OK'], 681054),
('Las Vegas', 'NV', 'US', 36.1699, -115.1398, ARRAY['Vegas', 'LV', 'L.V.', 'Las Vegas, NV'], 641903),
('Memphis', 'TN', 'US', 35.1495, -90.0490, ARRAY['Memphis, TN'], 633104),
('Louisville', 'KY', 'US', 38.2527, -85.7585, ARRAY['Louisville, KY'], 633045),
('Baltimore', 'MD', 'US', 39.2904, -76.6122, ARRAY['Baltimore, MD'], 576498),
('Milwaukee', 'WI', 'US', 43.0389, -87.9065, ARRAY['Milwaukee, WI'], 577222),
('Albuquerque', 'NM', 'US', 35.0844, -106.6504, ARRAY['Albuquerque, NM'], 564559),
('Tucson', 'AZ', 'US', 32.2226, -110.9747, ARRAY['Tucson, AZ'], 542629),
('Fresno', 'CA', 'US', 36.7378, -119.7871, ARRAY['Fresno, CA'], 542107),
('Sacramento', 'CA', 'US', 38.5816, -121.4944, ARRAY['Sacramento, CA'], 524943),
('Kansas City', 'MO', 'US', 39.0997, -94.5786, ARRAY['KC', 'Kansas City, MO'], 508090),
('Mesa', 'AZ', 'US', 33.4152, -111.8315, ARRAY['Mesa, AZ'], 504258),
('Atlanta', 'GA', 'US', 33.7490, -84.3880, ARRAY['Atlanta, GA'], 498715),
('Omaha', 'NE', 'US', 41.2565, -95.9345, ARRAY['Omaha, NE'], 486051),
('Colorado Springs', 'CO', 'US', 38.8339, -104.8214, ARRAY['Colorado Springs, CO'], 478961),
('Raleigh', 'NC', 'US', 35.7796, -78.6382, ARRAY['Raleigh, NC'], 474069),
('Virginia Beach', 'VA', 'US', 36.8529, -75.9780, ARRAY['Virginia Beach, VA'], 459470),
('Miami', 'FL', 'US', 25.7617, -80.1918, ARRAY['Mia', 'Mia.', 'Miami, FL'], 442241),
('Oakland', 'CA', 'US', 37.8044, -122.2712, ARRAY['Oakland, CA'], 433031),
('Minneapolis', 'MN', 'US', 44.9778, -93.2650, ARRAY['Minneapolis, MN'], 429606),
('Tulsa', 'OK', 'US', 36.1540, -95.9928, ARRAY['Tulsa, OK'], 413066),
('Tampa', 'FL', 'US', 27.9506, -82.4572, ARRAY['Tampa, FL'], 384959),
('Cleveland', 'OH', 'US', 41.4993, -81.6944, ARRAY['Cleveland, OH'], 383793),
('Wichita', 'KS', 'US', 37.6872, -97.3301, ARRAY['Wichita, KS'], 397532),
-- Cities 51-100
('Arlington', 'TX', 'US', 32.7357, -97.1081, ARRAY['Arlington, TX'], 394266),
('New Orleans', 'LA', 'US', 29.9511, -90.0715, ARRAY['NOLA', 'New Orleans, LA'], 383997),
('Honolulu', 'HI', 'US', 21.3099, -157.8581, ARRAY['Honolulu, HI'], 350964),
('Anaheim', 'CA', 'US', 33.8366, -117.9143, ARRAY['Anaheim, CA'], 346824),
('Santa Ana', 'CA', 'US', 33.7455, -117.8677, ARRAY['Santa Ana, CA'], 332318),
('St. Louis', 'MO', 'US', 38.6270, -90.1994, ARRAY['St Louis', 'Saint Louis', 'St. Louis, MO'], 301578),
('Corpus Christi', 'TX', 'US', 27.8006, -97.3964, ARRAY['Corpus Christi, TX'], 326586),
('Riverside', 'CA', 'US', 33.9533, -117.3962, ARRAY['Riverside, CA'], 314998),
('Lexington', 'KY', 'US', 38.0406, -84.5037, ARRAY['Lexington, KY'], 323152),
('Pittsburgh', 'PA', 'US', 40.4406, -79.9959, ARRAY['Pittsburgh, PA'], 302971),
('Anchorage', 'AK', 'US', 61.2181, -149.9003, ARRAY['Anchorage, AK'], 291247),
('Stockton', 'CA', 'US', 37.9577, -121.2908, ARRAY['Stockton, CA'], 310496),
('Cincinnati', 'OH', 'US', 39.1031, -84.5120, ARRAY['Cincinnati, OH'], 309317),
('St. Paul', 'MN', 'US', 44.9537, -93.0900, ARRAY['St Paul', 'Saint Paul', 'St. Paul, MN'], 311527),
('Toledo', 'OH', 'US', 41.6528, -83.5379, ARRAY['Toledo, OH'], 270871),
('Greensboro', 'NC', 'US', 36.0726, -79.7920, ARRAY['Greensboro, NC'], 299035),
('Newark', 'NJ', 'US', 40.7357, -74.1724, ARRAY['Newark, NJ'], 311549),
('Plano', 'TX', 'US', 33.0198, -96.6989, ARRAY['Plano, TX'], 285494),
('Henderson', 'NV', 'US', 36.0395, -114.9817, ARRAY['Henderson, NV'], 317610),
('Lincoln', 'NE', 'US', 40.8136, -96.7026, ARRAY['Lincoln, NE'], 291082),
('Buffalo', 'NY', 'US', 42.8864, -78.8784, ARRAY['Buffalo, NY'], 276807),
('Jersey City', 'NJ', 'US', 40.7178, -74.0431, ARRAY['Jersey City, NJ'], 292449),
('Chula Vista', 'CA', 'US', 32.6401, -117.0842, ARRAY['Chula Vista, CA'], 275487),
('Fort Wayne', 'IN', 'US', 41.0793, -85.1394, ARRAY['Fort Wayne, IN'], 270402),
('Orlando', 'FL', 'US', 28.5383, -81.3792, ARRAY['Orlando, FL'], 307573),
('St. Petersburg', 'FL', 'US', 27.7676, -82.6403, ARRAY['St Petersburg', 'Saint Petersburg', 'St. Petersburg, FL'], 258308),
('Chandler', 'AZ', 'US', 33.3062, -111.8413, ARRAY['Chandler, AZ'], 275987),
('Laredo', 'TX', 'US', 27.5306, -99.4803, ARRAY['Laredo, TX'], 256187),
('Norfolk', 'VA', 'US', 36.8468, -76.2852, ARRAY['Norfolk, VA'], 238005),
('Durham', 'NC', 'US', 35.9940, -78.8986, ARRAY['Durham, NC'], 278993),
('Madison', 'WI', 'US', 43.0731, -89.4012, ARRAY['Madison, WI'], 269840),
('Lubbock', 'TX', 'US', 33.5779, -101.8552, ARRAY['Lubbock, TX'], 257141),
('Irvine', 'CA', 'US', 33.6846, -117.8265, ARRAY['Irvine, CA'], 307670),
('Winston-Salem', 'NC', 'US', 36.0999, -80.2442, ARRAY['Winston Salem', 'Winston-Salem, NC'], 247945),
('Glendale', 'AZ', 'US', 33.5387, -112.1860, ARRAY['Glendale, AZ'], 248325),
('Garland', 'TX', 'US', 32.9126, -96.6389, ARRAY['Garland, TX'], 246018),
('Hialeah', 'FL', 'US', 25.8576, -80.2781, ARRAY['Hialeah, FL'], 223109),
('Reno', 'NV', 'US', 39.5296, -119.8138, ARRAY['Reno, NV'], 264165),
('Chesapeake', 'VA', 'US', 36.7682, -76.2875, ARRAY['Chesapeake, VA'], 249422),
('Gilbert', 'AZ', 'US', 33.3528, -111.7890, ARRAY['Gilbert, AZ'], 267918),
('Baton Rouge', 'LA', 'US', 30.4515, -91.1871, ARRAY['Baton Rouge, LA'], 227470),
('Irving', 'TX', 'US', 32.8140, -96.9489, ARRAY['Irving, TX'], 256684),
('Scottsdale', 'AZ', 'US', 33.4942, -111.9261, ARRAY['Scottsdale, AZ'], 241361),
('North Las Vegas', 'NV', 'US', 36.1989, -115.1175, ARRAY['North Las Vegas, NV'], 262527),
('Fremont', 'CA', 'US', 37.5483, -121.9886, ARRAY['Fremont, CA'], 230504),
('Boise', 'ID', 'US', 43.6150, -116.2023, ARRAY['Boise, ID'], 235684),
('Richmond', 'VA', 'US', 37.5407, -77.4360, ARRAY['Richmond, VA'], 226610),
('San Bernardino', 'CA', 'US', 34.1083, -117.2898, ARRAY['San Bernardino, CA'], 222101),
('Birmingham', 'AL', 'US', 33.5207, -86.8025, ARRAY['Birmingham, AL'], 200733),
('Spokane', 'WA', 'US', 47.6588, -117.4260, ARRAY['Spokane, WA'], 228989),
('Rochester', 'NY', 'US', 43.1566, -77.6088, ARRAY['Rochester, NY'], 211328),
('Des Moines', 'IA', 'US', 41.5868, -93.6250, ARRAY['Des Moines, IA'], 214133),
('Modesto', 'CA', 'US', 37.6391, -120.9969, ARRAY['Modesto, CA'], 218464),
('Fayetteville', 'NC', 'US', 35.0527, -78.8784, ARRAY['Fayetteville, NC'], 208501),
('Tacoma', 'WA', 'US', 47.2529, -122.4443, ARRAY['Tacoma, WA'], 219346),
('Oxnard', 'CA', 'US', 34.1975, -119.1771, ARRAY['Oxnard, CA'], 202063),
('Fontana', 'CA', 'US', 34.0922, -117.4350, ARRAY['Fontana, CA'], 208393),
('Columbus', 'GA', 'US', 32.4610, -84.9877, ARRAY['Columbus, GA'], 206922),
('Montgomery', 'AL', 'US', 32.3668, -86.3000, ARRAY['Montgomery, AL'], 200603),
('Moreno Valley', 'CA', 'US', 33.9425, -117.2297, ARRAY['Moreno Valley, CA'], 208634),
('Shreveport', 'LA', 'US', 32.5252, -93.7502, ARRAY['Shreveport, LA'], 187593),
('Aurora', 'IL', 'US', 41.7606, -88.3201, ARRAY['Aurora, IL'], 180542),
('Yonkers', 'NY', 'US', 40.9312, -73.8988, ARRAY['Yonkers, NY'], 211569),
('Akron', 'OH', 'US', 41.0814, -81.5190, ARRAY['Akron, OH'], 197597),
('Huntington Beach', 'CA', 'US', 33.6595, -117.9988, ARRAY['Huntington Beach, CA'], 198711),
('Little Rock', 'AR', 'US', 34.7465, -92.2896, ARRAY['Little Rock, AR'], 202591),
('Amarillo', 'TX', 'US', 35.2220, -101.8313, ARRAY['Amarillo, TX'], 200393),
('Glendale', 'CA', 'US', 34.1425, -118.2551, ARRAY['Glendale, CA'], 196543),
('Grand Rapids', 'MI', 'US', 42.9634, -85.6681, ARRAY['Grand Rapids, MI'], 198917),
('Salt Lake City', 'UT', 'US', 40.7608, -111.8910, ARRAY['SLC', 'Salt Lake City, UT'], 200133),
('Tallahassee', 'FL', 'US', 30.4383, -84.2807, ARRAY['Tallahassee, FL'], 196169),
('Huntsville', 'AL', 'US', 34.7304, -86.5861, ARRAY['Huntsville, AL'], 221933),
('Grand Prairie', 'TX', 'US', 32.7459, -96.9978, ARRAY['Grand Prairie, TX'], 196100),
('Knoxville', 'TN', 'US', 35.9606, -83.9207, ARRAY['Knoxville, TN'], 190740),
('Worcester', 'MA', 'US', 42.2626, -71.8023, ARRAY['Worcester, MA'], 206518),
('Newport News', 'VA', 'US', 37.0871, -76.4730, ARRAY['Newport News, VA'], 179225),
('Brownsville', 'TX', 'US', 25.9017, -97.4975, ARRAY['Brownsville, TX'], 186738),
('Overland Park', 'KS', 'US', 38.9822, -94.6708, ARRAY['Overland Park, KS'], 197238),
('Santa Clarita', 'CA', 'US', 34.3917, -118.5426, ARRAY['Santa Clarita, CA'], 228673),
('Providence', 'RI', 'US', 41.8240, -71.4128, ARRAY['Providence, RI'], 190934),
('Garden Grove', 'CA', 'US', 33.7739, -117.9414, ARRAY['Garden Grove, CA'], 172800),
('Chattanooga', 'TN', 'US', 35.0456, -85.3097, ARRAY['Chattanooga, TN'], 181099),
('Oceanside', 'CA', 'US', 33.1959, -117.3795, ARRAY['Oceanside, CA'], 174068),
('Jackson', 'MS', 'US', 32.2988, -90.1848, ARRAY['Jackson, MS'], 153701),
('Fort Lauderdale', 'FL', 'US', 26.1224, -80.1373, ARRAY['Fort Lauderdale, FL'], 182760),
('Santa Rosa', 'CA', 'US', 38.4404, -122.7141, ARRAY['Santa Rosa, CA'], 178127),
('Rancho Cucamonga', 'CA', 'US', 34.1064, -117.5931, ARRAY['Rancho Cucamonga, CA'], 174453),
('Port St. Lucie', 'FL', 'US', 27.2730, -80.3582, ARRAY['Port St Lucie', 'Port St. Lucie, FL'], 217523),
('Tempe', 'AZ', 'US', 33.4255, -111.9400, ARRAY['Tempe, AZ'], 190365),
('Ontario', 'CA', 'US', 34.0633, -117.6509, ARRAY['Ontario, CA'], 175265),
('Vancouver', 'WA', 'US', 45.6387, -122.6615, ARRAY['Vancouver, WA'], 190915),
('Sioux Falls', 'SD', 'US', 43.5446, -96.7311, ARRAY['Sioux Falls, SD'], 192517),
('Peoria', 'AZ', 'US', 33.5806, -112.2374, ARRAY['Peoria, AZ'], 190985),
('Springfield', 'MO', 'US', 37.2089, -93.2923, ARRAY['Springfield, MO'], 169176),
('Pembroke Pines', 'FL', 'US', 26.0123, -80.2231, ARRAY['Pembroke Pines, FL'], 171178),
('Elk Grove', 'CA', 'US', 38.4088, -121.3716, ARRAY['Elk Grove, CA'], 176124),
('Salem', 'OR', 'US', 44.9429, -123.0351, ARRAY['Salem, OR'], 177723),
('Lancaster', 'CA', 'US', 34.6868, -118.1542, ARRAY['Lancaster, CA'], 157265),
('Corona', 'CA', 'US', 33.8753, -117.5664, ARRAY['Corona, CA'], 157136),
('Eugene', 'OR', 'US', 44.0521, -123.0868, ARRAY['Eugene, OR'], 176654),
('Palmdale', 'CA', 'US', 34.5794, -118.1165, ARRAY['Palmdale, CA'], 169450),
('Salinas', 'CA', 'US', 36.6777, -121.6555, ARRAY['Salinas, CA'], 163542),
('Springfield', 'MA', 'US', 42.1015, -72.5898, ARRAY['Springfield, MA'], 155929),
('Pasadena', 'TX', 'US', 29.6911, -95.2091, ARRAY['Pasadena, TX'], 151950),
('Fort Collins', 'CO', 'US', 40.5853, -105.0844, ARRAY['Fort Collins, CO'], 169810),
('Hayward', 'CA', 'US', 37.6688, -122.0808, ARRAY['Hayward, CA'], 162954),
('Pomona', 'CA', 'US', 34.0551, -117.7498, ARRAY['Pomona, CA'], 151713),
('Cary', 'NC', 'US', 35.7915, -78.7811, ARRAY['Cary, NC'], 174721),
('Rockford', 'IL', 'US', 42.2711, -89.0940, ARRAY['Rockford, IL'], 148655),
('Alexandria', 'VA', 'US', 38.8048, -77.0469, ARRAY['Alexandria, VA'], 159467),
('Escondido', 'CA', 'US', 33.1192, -117.0864, ARRAY['Escondido, CA'], 151038),
('McKinney', 'TX', 'US', 33.1972, -96.6397, ARRAY['McKinney, TX'], 195308),
('Kansas City', 'KS', 'US', 39.1142, -94.6275, ARRAY['Kansas City, KS'], 156607),
('Joliet', 'IL', 'US', 41.5250, -88.0817, ARRAY['Joliet, IL'], 150362),
('Sunnyvale', 'CA', 'US', 37.3688, -122.0363, ARRAY['Sunnyvale, CA'], 155805),
('Torrance', 'CA', 'US', 33.8358, -118.3406, ARRAY['Torrance, CA'], 141126),
('Bridgeport', 'CT', 'US', 41.1865, -73.1952, ARRAY['Bridgeport, CT'], 148654),
('Lakewood', 'CO', 'US', 39.7047, -105.0814, ARRAY['Lakewood, CO'], 155984),
('Hollywood', 'FL', 'US', 26.0112, -80.1495, ARRAY['Hollywood, FL'], 153067),
('Paterson', 'NJ', 'US', 40.9168, -74.1718, ARRAY['Paterson, NJ'], 159732),
('Naperville', 'IL', 'US', 41.7508, -88.1535, ARRAY['Naperville, IL'], 149540),
('Syracuse', 'NY', 'US', 43.0481, -76.1474, ARRAY['Syracuse, NY'], 148620),
('Mesquite', 'TX', 'US', 32.7668, -96.5992, ARRAY['Mesquite, TX'], 150108),
('Dayton', 'OH', 'US', 39.7589, -84.1916, ARRAY['Dayton, OH'], 140407),
('Savannah', 'GA', 'US', 32.0809, -81.0912, ARRAY['Savannah, GA'], 147780),
('Clarksville', 'TN', 'US', 36.5298, -87.3595, ARRAY['Clarksville, TN'], 166722),
('Orange', 'CA', 'US', 33.7879, -117.8531, ARRAY['Orange, CA'], 139911),
('Pasadena', 'CA', 'US', 34.1478, -118.1445, ARRAY['Pasadena, CA'], 138699),
('Fullerton', 'CA', 'US', 33.8704, -117.9242, ARRAY['Fullerton, CA'], 135161),
('Killeen', 'TX', 'US', 31.1171, -97.7278, ARRAY['Killeen, TX'], 153095),
('Frisco', 'TX', 'US', 33.1507, -96.8236, ARRAY['Frisco, TX'], 200509),
('Hampton', 'VA', 'US', 37.0299, -76.3452, ARRAY['Hampton, VA'], 137148),
('McAllen', 'TX', 'US', 26.2034, -98.2300, ARRAY['McAllen, TX'], 142210),
('Warren', 'MI', 'US', 42.5145, -83.0147, ARRAY['Warren, MI'], 139387),
('Bellevue', 'WA', 'US', 47.6101, -122.2015, ARRAY['Bellevue, WA'], 151854),
('West Valley City', 'UT', 'US', 40.6916, -112.0011, ARRAY['West Valley City, UT'], 140230),
('Columbia', 'SC', 'US', 34.0007, -81.0348, ARRAY['Columbia, SC'], 136632),
('Olathe', 'KS', 'US', 38.8814, -94.8191, ARRAY['Olathe, KS'], 141290),
('Sterling Heights', 'MI', 'US', 42.5803, -83.0302, ARRAY['Sterling Heights, MI'], 134346),
('New Haven', 'CT', 'US', 41.3083, -72.9279, ARRAY['New Haven, CT'], 134023),
('Miramar', 'FL', 'US', 25.9861, -80.3036, ARRAY['Miramar, FL'], 134721),
('Waco', 'TX', 'US', 31.5493, -97.1467, ARRAY['Waco, TX'], 138486),
('Thousand Oaks', 'CA', 'US', 34.1706, -118.8376, ARRAY['Thousand Oaks, CA'], 126683),
('Cedar Rapids', 'IA', 'US', 41.9778, -91.6656, ARRAY['Cedar Rapids, IA'], 137710),
('Charleston', 'SC', 'US', 32.7765, -79.9311, ARRAY['Charleston, SC'], 150227),
('Visalia', 'CA', 'US', 36.3302, -119.2921, ARRAY['Visalia, CA'], 141384),
('Topeka', 'KS', 'US', 39.0473, -95.6752, ARRAY['Topeka, KS'], 126587),
('Elizabeth', 'NJ', 'US', 40.6639, -74.2107, ARRAY['Elizabeth, NJ'], 137298),
('Gainesville', 'FL', 'US', 29.6516, -82.3248, ARRAY['Gainesville, FL'], 141085),
('Thornton', 'CO', 'US', 39.8680, -104.9719, ARRAY['Thornton, CO'], 141867),
('Roseville', 'CA', 'US', 38.7521, -121.2880, ARRAY['Roseville, CA'], 147773),
('Carrollton', 'TX', 'US', 32.9756, -96.8899, ARRAY['Carrollton, TX'], 139248),
('Coral Springs', 'FL', 'US', 26.2712, -80.2706, ARRAY['Coral Springs, FL'], 134394),
('Stamford', 'CT', 'US', 41.0534, -73.5387, ARRAY['Stamford, CT'], 135470),
('Simi Valley', 'CA', 'US', 34.2694, -118.7815, ARRAY['Simi Valley, CA'], 125613),
('Concord', 'CA', 'US', 37.9780, -122.0311, ARRAY['Concord, CA'], 129295),
('Hartford', 'CT', 'US', 41.7658, -72.6734, ARRAY['Hartford, CT'], 121054),
('Kent', 'WA', 'US', 47.3809, -122.2348, ARRAY['Kent, WA'], 132319),
('Lafayette', 'LA', 'US', 30.2241, -92.0198, ARRAY['Lafayette, LA'], 121374),
('Midland', 'TX', 'US', 31.9973, -102.0779, ARRAY['Midland, TX'], 132524),
('Surprise', 'AZ', 'US', 33.6292, -112.3679, ARRAY['Surprise, AZ'], 143148),
('Denton', 'TX', 'US', 33.2148, -97.1331, ARRAY['Denton, TX'], 139869),
('Victorville', 'CA', 'US', 34.5361, -117.2912, ARRAY['Victorville, CA'], 134810),
('Evansville', 'IN', 'US', 37.9748, -87.5558, ARRAY['Evansville, IN'], 117429),
('Santa Clara', 'CA', 'US', 37.3541, -121.9552, ARRAY['Santa Clara, CA'], 127647),
('Abilene', 'TX', 'US', 32.4487, -99.7331, ARRAY['Abilene, TX'], 125182),
('Athens', 'GA', 'US', 33.9519, -83.3576, ARRAY['Athens, GA'], 127315),
('Vallejo', 'CA', 'US', 38.1041, -122.2566, ARRAY['Vallejo, CA'], 126090),
('Allentown', 'PA', 'US', 40.6084, -75.4902, ARRAY['Allentown, PA'], 125845),
('Norman', 'OK', 'US', 35.2226, -97.4395, ARRAY['Norman, OK'], 128026),
('Beaumont', 'TX', 'US', 30.0802, -94.1266, ARRAY['Beaumont, TX'], 115282),
('Independence', 'MO', 'US', 39.0911, -94.4155, ARRAY['Independence, MO'], 123011),
('Murfreesboro', 'TN', 'US', 35.8456, -86.3903, ARRAY['Murfreesboro, TN'], 152769),
('Ann Arbor', 'MI', 'US', 42.2808, -83.7430, ARRAY['Ann Arbor, MI'], 123851),
('Springfield', 'IL', 'US', 39.7817, -89.6501, ARRAY['Springfield, IL'], 114394),
('Berkeley', 'CA', 'US', 37.8715, -122.2730, ARRAY['Berkeley, CA'], 124321),
('Peoria', 'IL', 'US', 40.6936, -89.5890, ARRAY['Peoria, IL'], 113150),
('Provo', 'UT', 'US', 40.2181, -111.6133, ARRAY['Provo, UT'], 115162),
('El Monte', 'CA', 'US', 34.0686, -118.0276, ARRAY['El Monte, CA'], 109450),
('Columbia', 'MO', 'US', 38.9517, -92.3341, ARRAY['Columbia, MO'], 126254),
('Lansing', 'MI', 'US', 42.7325, -84.5555, ARRAY['Lansing, MI'], 118210),
('Fargo', 'ND', 'US', 46.8772, -96.7898, ARRAY['Fargo, ND'], 125990),
('Downey', 'CA', 'US', 33.9401, -118.1332, ARRAY['Downey, CA'], 111772),
('Costa Mesa', 'CA', 'US', 33.6411, -117.9187, ARRAY['Costa Mesa, CA'], 111918),
('Wilmington', 'NC', 'US', 34.2257, -77.9447, ARRAY['Wilmington, NC'], 115451),
('Arvada', 'CO', 'US', 39.8028, -105.0875, ARRAY['Arvada, CO'], 124402),
('Inglewood', 'CA', 'US', 33.9617, -118.3531, ARRAY['Inglewood, CA'], 107762),
('Miami Gardens', 'FL', 'US', 25.9420, -80.2456, ARRAY['Miami Gardens, FL'], 111640),
('Carlsbad', 'CA', 'US', 33.1581, -117.3506, ARRAY['Carlsbad, CA'], 114746),
('Westminster', 'CO', 'US', 39.8367, -105.0372, ARRAY['Westminster, CO'], 116317),
('Rochester', 'MN', 'US', 44.0216, -92.4699, ARRAY['Rochester, MN'], 121395),
('Odessa', 'TX', 'US', 31.8457, -102.3676, ARRAY['Odessa, TX'], 114428),
('Manchester', 'NH', 'US', 42.9956, -71.4548, ARRAY['Manchester, NH'], 115644),
('Elgin', 'IL', 'US', 42.0354, -88.2826, ARRAY['Elgin, IL'], 114797),
('West Jordan', 'UT', 'US', 40.6097, -111.9391, ARRAY['West Jordan, UT'], 116961),
('Round Rock', 'TX', 'US', 30.5083, -97.6789, ARRAY['Round Rock, TX'], 128812),
('Clearwater', 'FL', 'US', 27.9659, -82.8001, ARRAY['Clearwater, FL'], 117292),
('Waterbury', 'CT', 'US', 41.5582, -73.0515, ARRAY['Waterbury, CT'], 114403),
('Gresham', 'OR', 'US', 45.4982, -122.4315, ARRAY['Gresham, OR'], 114247),
('Fairfield', 'CA', 'US', 38.2494, -122.0400, ARRAY['Fairfield, CA'], 119881),
('Billings', 'MT', 'US', 45.7833, -108.5007, ARRAY['Billings, MT'], 117116),
('Lowell', 'MA', 'US', 42.6334, -71.3162, ARRAY['Lowell, MA'], 115554),
('San Buenaventura', 'CA', 'US', 34.2746, -119.2290, ARRAY['Ventura', 'San Buenaventura, CA'], 110763),
('Pueblo', 'CO', 'US', 38.2544, -104.6091, ARRAY['Pueblo, CO'], 111876),
('High Point', 'NC', 'US', 35.9557, -80.0053, ARRAY['High Point, NC'], 114059),
('West Palm Beach', 'FL', 'US', 26.7153, -80.0534, ARRAY['West Palm Beach, FL'], 117415),
('Antioch', 'CA', 'US', 37.9819, -121.7958, ARRAY['Antioch, CA'], 115291),
('Everett', 'WA', 'US', 47.9789, -122.2021, ARRAY['Everett, WA'], 110629),
('Pompano Beach', 'FL', 'US', 26.2379, -80.1248, ARRAY['Pompano Beach, FL'], 112046),
('Boulder', 'CO', 'US', 40.0150, -105.2705, ARRAY['Boulder, CO'], 108250),
('West Covina', 'CA', 'US', 34.0686, -117.9390, ARRAY['West Covina, CA'], 109501),
('Broken Arrow', 'OK', 'US', 36.0609, -95.7975, ARRAY['Broken Arrow, OK'], 113540),
('Lakeland', 'FL', 'US', 28.0395, -81.9498, ARRAY['Lakeland, FL'], 112641),
('North Charleston', 'SC', 'US', 32.8546, -79.9748, ARRAY['North Charleston, SC'], 114852),
('Lewisville', 'TX', 'US', 33.0462, -96.9942, ARRAY['Lewisville, TX'], 131215),
('Tyler', 'TX', 'US', 32.3513, -95.3011, ARRAY['Tyler, TX'], 105995),
('El Cajon', 'CA', 'US', 32.7948, -116.9625, ARRAY['El Cajon, CA'], 106215),
('Burbank', 'CA', 'US', 34.1808, -118.3090, ARRAY['Burbank, CA'], 107337),
('Longmont', 'CO', 'US', 40.1672, -105.1019, ARRAY['Longmont, CO'], 98385),
('Renton', 'WA', 'US', 47.4829, -122.2171, ARRAY['Renton, WA'], 106785),
('Vista', 'CA', 'US', 33.2000, -117.2425, ARRAY['Vista, CA'], 101638),
('Davie', 'FL', 'US', 26.0765, -80.2522, ARRAY['Davie, FL'], 105691),
('Greeley', 'CO', 'US', 40.4233, -104.7091, ARRAY['Greeley, CO'], 108795),
('Mission Viejo', 'CA', 'US', 33.6000, -117.6720, ARRAY['Mission Viejo, CA'], 93653),
('Hillsboro', 'OR', 'US', 45.5229, -122.9898, ARRAY['Hillsboro, OR'], 106894),
('Richmond', 'CA', 'US', 37.9358, -122.3477, ARRAY['Richmond, CA'], 114888),
('Compton', 'CA', 'US', 33.8958, -118.2201, ARRAY['Compton, CA'], 97240),
('South Bend', 'IN', 'US', 41.6764, -86.2520, ARRAY['South Bend, IN'], 103453),
('Vacaville', 'CA', 'US', 38.3566, -121.9877, ARRAY['Vacaville, CA'], 100883),
('San Mateo', 'CA', 'US', 37.5630, -122.3255, ARRAY['San Mateo, CA'], 103536),
('Rialto', 'CA', 'US', 34.1064, -117.3703, ARRAY['Rialto, CA'], 104026),
('Lee''s Summit', 'MO', 'US', 38.9108, -94.3822, ARRAY['Lees Summit', 'Lee''s Summit, MO'], 101108),
('Sparks', 'NV', 'US', 39.5349, -119.7527, ARRAY['Sparks, NV'], 108445),
('Roanoke', 'VA', 'US', 37.2710, -79.9414, ARRAY['Roanoke, VA'], 100011),
('Daly City', 'CA', 'US', 37.6879, -122.4702, ARRAY['Daly City, CA'], 104901),
('Bellingham', 'WA', 'US', 48.7519, -122.4787, ARRAY['Bellingham, WA'], 91382),
('Kenosha', 'WI', 'US', 42.5847, -87.8212, ARRAY['Kenosha, WI'], 99858),
('Lynn', 'MA', 'US', 42.4668, -70.9495, ARRAY['Lynn, MA'], 101253),
('Taylorsville', 'UT', 'US', 40.6677, -111.9388, ARRAY['Taylorsville, UT'], 60652),
('Green Bay', 'WI', 'US', 44.5192, -88.0198, ARRAY['Green Bay, WI'], 107395),
('Wichita Falls', 'TX', 'US', 33.9137, -98.4934, ARRAY['Wichita Falls, TX'], 104710),
('Sandy', 'UT', 'US', 40.5698, -111.8501, ARRAY['Sandy, UT'], 96184),
('Federal Way', 'WA', 'US', 47.3223, -122.3126, ARRAY['Federal Way, WA'], 101030),
('Boca Raton', 'FL', 'US', 26.3683, -80.1289, ARRAY['Boca Raton, FL'], 97422),
('Santa Monica', 'CA', 'US', 34.0195, -118.4912, ARRAY['Santa Monica, CA'], 93076),
('Tuscaloosa', 'AL', 'US', 33.2098, -87.5692, ARRAY['Tuscaloosa, AL'], 100618),
('Livonia', 'MI', 'US', 42.3684, -83.3527, ARRAY['Livonia, MI'], 95233),
('New Bedford', 'MA', 'US', 41.6362, -70.9342, ARRAY['New Bedford, MA'], 101079),
('Hemet', 'CA', 'US', 33.7475, -116.9710, ARRAY['Hemet, CA'], 89833),
('Edinburg', 'TX', 'US', 26.3017, -98.1633, ARRAY['Edinburg, TX'], 100243),
('Yuma', 'AZ', 'US', 32.6927, -114.6277, ARRAY['Yuma, AZ'], 100041),
('Spokane Valley', 'WA', 'US', 47.6732, -117.2394, ARRAY['Spokane Valley, WA'], 102976),
('Bend', 'OR', 'US', 44.0582, -121.3153, ARRAY['Bend, OR'], 102059),
('Racine', 'WI', 'US', 42.7261, -87.7829, ARRAY['Racine, WI'], 77816),
('Sandy Springs', 'GA', 'US', 33.9304, -84.3733, ARRAY['Sandy Springs, GA'], 108080),
('Jurupa Valley', 'CA', 'US', 34.0011, -117.4706, ARRAY['Jurupa Valley, CA'], 105053),
('Edmond', 'OK', 'US', 35.6528, -97.4781, ARRAY['Edmond, OK'], 94428),
('Brockton', 'MA', 'US', 42.0834, -71.0184, ARRAY['Brockton, MA'], 105643)
ON CONFLICT (normalized_name, state, country) DO UPDATE SET
  center_latitude = EXCLUDED.center_latitude,
  center_longitude = EXCLUDED.center_longitude,
  aliases = EXCLUDED.aliases,
  population = EXCLUDED.population,
  updated_at = NOW();

-- Update event_count from actual events table
UPDATE public.city_centers cc
SET event_count = (
  SELECT COUNT(*)
  FROM public.events e
  WHERE (
    LOWER(TRIM(e.venue_city)) = LOWER(TRIM(cc.normalized_name))
    OR LOWER(TRIM(e.venue_city)) = ANY(SELECT LOWER(TRIM(unnest(cc.aliases))))
  )
  AND (cc.state IS NULL OR e.venue_state = cc.state)
  AND e.event_date >= NOW()
);

-- Add helpful comments
COMMENT ON TABLE public.city_centers IS 'Normalized city names with pre-calculated center coordinates for accurate radius-based filtering';
COMMENT ON COLUMN public.city_centers.normalized_name IS 'Canonical city name (e.g., "Washington" for Washington DC)';
COMMENT ON COLUMN public.city_centers.aliases IS 'Array of city name variations (e.g., ["Washington DC", "Washington D.C.", "DC"])';
COMMENT ON COLUMN public.city_centers.center_latitude IS 'Pre-calculated city center latitude for radius filtering';
COMMENT ON COLUMN public.city_centers.center_longitude IS 'Pre-calculated city center longitude for radius filtering';
COMMENT ON COLUMN public.city_centers.event_count IS 'Number of upcoming events in this city (updated periodically)';

